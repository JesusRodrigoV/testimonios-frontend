<div class="feed-container">
  <div class="feed-header">
    <h2>Testimonios del Bicentenario</h2>
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Buscar testimonios</mat-label>
      <input
        matInput
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearchQueryChange($event)"
        placeholder="Escribe para buscar..."
      />
      <button
        mat-icon-button
        matSuffix
        *ngIf="searchQuery"
        (click)="clearSearch()"
        aria-label="Limpiar bÃºsqueda"
      >
        <mat-icon>clear</mat-icon>
      </button>
    </mat-form-field>
  </div>

  <div class="testimony-feed">
    @defer (when testimonies.length > 0 || !loading) {
      <div class="testimonies-wrapper">
        @for (testimony of testimonies; track testimony.id) {
          <app-testimony [testimony]="testimony"></app-testimony>
        } @empty {
          <div class="empty-state">
            <mat-icon>info</mat-icon>
            <p>No se encontraron testimonios</p>
          </div>
        }
      </div>
    } @placeholder (minimum 500ms) {
      <div class="skeleton-container">
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
      </div>
    } @loading (minimum 1s; after 500ms) {
      <div class="loading">
        <axl-spinner />
        <p>Cargando testimonios...</p>
      </div>
    } @error {
      <div class="error">
        <mat-icon>error</mat-icon>
        <p>{{ error || 'Error al cargar los testimonios. Por favor, intenta de nuevo.' }}</p>
      </div>
    }

    <div id="loadMoreTrigger" *ngIf="hasMore && !loading && !error"></div>
  </div>
</div>