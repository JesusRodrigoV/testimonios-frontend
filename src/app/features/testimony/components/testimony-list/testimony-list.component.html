<section class="testimonies-section">
  <div class="section-header">
    <h2>Testimonios Destacados</h2>
    <mat-form-field appearance="outline" class="search-field">
      <mat-icon matPrefix>search</mat-icon>
      <input
        matInput
        placeholder="Buscar testimonios..."
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearch()"
      />
    </mat-form-field>
  </div>

  <div class="testimonies-grid">
    @for (testimony of testimonies; track testimony.id) {
      <mat-card class="testimony-card" [class.featured]="testimony.featured">
        <div class="testimony-media" [ngSwitch]="testimony.type">
          @switch (testimony.type) {
            @case ("video") {
              <div class="video-thumbnail">
                <img [src]="testimony.thumbnail" [alt]="testimony.title" />
                <mat-icon class="media-icon">play_circle</mat-icon>
              </div>
            }
            @case ("audio") {
              <div class="audio-thumbnail">
                <img [src]="testimony.thumbnail" [alt]="testimony.title" />
                <mat-icon class="media-icon">audiotrack</mat-icon>
              </div>
            }
            @default {
              <img
                [src]="testimony.thumbnail"
                [alt]="testimony.title"
                mat-card-image
              />
            }
          }
        </div>
        <mat-card-content>
          <div class="testimony-header">
            <h3>{{ testimony.title }}</h3>
            @if (testimony.status === "restricted") {
              <mat-icon class="restricted-icon" matTooltip="Acceso restringido"
                >lock</mat-icon
              >
            }
          </div>
          <p class="testimony-meta">
            <span class="date">{{ testimony.date | date }}</span>
            <span class="location">
              <mat-icon>location_on</mat-icon>
              {{ testimony.location.name }}
            </span>
            <span class="type" [class]="testimony.type">
              <mat-icon>{{
                testimony.type === "video"
                  ? "videocam"
                  : testimony.type === "audio"
                    ? "mic"
                    : "article"
              }}</mat-icon>
              {{ testimony.type }}
            </span>
          </p>
          <p class="testimony-description">{{ testimony.description }}</p>
          <mat-chip-listbox>
            @for (tag of testimony.tags; track tag) {
              <mat-chip-option>{{ tag }}</mat-chip-option>
            }
          </mat-chip-listbox>
        </mat-card-content>
        <mat-card-actions>
          <button mat-button color="primary" (click)="viewTestimony(testimony)">
            <mat-icon>visibility</mat-icon>
            Ver Testimonio
          </button>
          <div class="testimony-stats">
            <button
              mat-icon-button
              [matBadge]="testimony.commentsCount"
              matBadgeColor="accent"
            >
              <mat-icon>comment</mat-icon>
            </button>
            <button
              mat-icon-button
              [matBadge]="testimony.likes"
              matBadgeColor="primary"
            >
              <mat-icon>favorite</mat-icon>
            </button>
            <button mat-icon-button>
              <mat-icon>share</mat-icon>
            </button>
          </div>
        </mat-card-actions>
      </mat-card>
    }
  </div>
</section>
