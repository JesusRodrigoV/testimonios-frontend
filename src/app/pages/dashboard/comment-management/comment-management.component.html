<div class="management-container">
  <div class="header">
    <h1>Gesti√≥n de Comentarios</h1>
    <button mat-button  (click)="refreshComments()">
      <i class="bx bx-refresh"></i>
      Actualizar
    </button>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Contenido</th>
          <th>Testimonio</th>
          <th>Usuario</th>
          <th>Fecha</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (comment of comments; track comment) {
          <tr>
            <td class="text-muted">#{{ comment.id_comentario }}</td>
            <td>{{ comment.contenido }}</td>
            <td>{{ comment.id_testimonio }}</td>
            <td>{{ comment.creado_por_id_usuario }}</td>
            <td>{{ comment.fecha_creacion | date: 'medium' }}</td>
            <td>
              <span
                [ngClass]="{
                  'status-badge': true,
                  'status-pendiente': comment.id_estado === 1,
                  'status-aprobado': comment.id_estado === 2,
                  'status-rechazado': comment.id_estado === 3
                }"
              >
                {{ comment.id_estado === 1 ? 'Pendiente' : comment.id_estado === 2 ? 'Aprobado' : 'Rechazado' }}
              </span>
            </td>
            <td>
              <div class="actions">
                <button
                  class="btn-icon view"
                  (click)="openTestimonyDialog(comment.id_testimonio)"
                  matTooltip="Ver detalles"
                >
                  <i class="bx bx-show"></i>
                </button>
                @if (comment.id_estado !== 2) {
                  <button
                    class="btn-icon approve"
                    (click)="approveComment(comment.id_comentario)"
                    matTooltip="Aprobar"
                  >
                    <i class="bx bx-check"></i>
                  </button>
                }
                @if (comment.id_estado !== 3) {
                  <button
                    class="btn-icon reject"
                    (click)="rejectComment(comment.id_comentario)"
                    matTooltip="Rechazar"
                  >
                    <i class="bx bx-x"></i>
                  </button>
                }
                <button
                  class="btn-icon delete"
                  (click)="deleteComment(comment.id_comentario)"
                  matTooltip="Eliminar"
                >
                  <i class="bx bx-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        } @empty {
          <tr>
            <td colspan="7" style="text-align: center">
              No hay comentarios para mostrar.
            </td>
          </tr>
        }
      </tbody>
    </table>

    @if (isLoading) {
      <div class="loading-overlay">
        <axl-spinner></axl-spinner>
      </div>
    }
  </div>
</div>